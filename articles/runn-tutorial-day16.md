---
title: "ã€Day16ã€‘JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿ã‚’ã—ã¦ã¿ã‚‹ / runnãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"
emoji: "ğŸ“‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["e2e","automation","api","ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«","ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"]
published: true
published_at: 2023-12-16 00:00
---

:::message
ã“ã®è¨˜äº‹ã¯ [runnãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« Advent Calendar 2023](https://qiita.com/advent-calendar/2023/runn-tutorial)ã® 12/16 é…ä¿¡ã«ãªã‚Šã¾ã™ã€‚
<!-- markdownlint-disable-next-line ja-technical-writing/ja-no-mixed-period -->
:::

## ã¯ã˜ã‚ã«

ä¸€äººã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã—ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦çµ¶è³›æ²è¼‰ä¸­ã§ã™ã€‚  
æœ¬è¨˜äº‹ã¯ API ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã‚‚ã‚ã‚‹ [runn](https://github.com/k1LoW/runn) ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ç†è§£ã—ã¦è²°ãŠã†ï¼ã¨ã„ã†ã®ãŒè¶£æ—¨ã§ã™ã€‚  
25 æ—¥é–“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’çµŒã¦ã€ runn ã‚’ä½¿ã£ã¦ã® API ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆã‚„ã€ API ã¨é€£å‹•ã•ã›ã‚‹è‡ªå‹•åŒ–å‡¦ç†ã‚’ä¸€äººã§è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã‚’ç›®æ¨™ã«ã—ã¦ã„ã¾ã™ã€‚ 
runn is ä½•ï¼Ÿã¨ã„ã†æ–¹ã¯ã€ä»¥ä¸‹ã«ç´¹ä»‹è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã®ã§ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚

https://zenn.dev/katzumi/articles/api-scenario-testing-with-runn

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å®Ÿéš›ã«è©¦ã—ã€ã‚‚ã—èº“ã„ãŸç®‡æ‰€ãŒã‚ã‚Œã°ã€è¨˜äº‹ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã«ãŠçŸ¥ã‚‰ã›ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

å‰æ—¥ã®è¨˜äº‹ã¯ã€Œ[ãƒªã‚¯ã‚¨ã‚¹ãƒˆJSONã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹](https://zenn.dev/katzumi/articles/runn-tutorial-day15)ã€ã§ã—ãŸã€‚

## JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŸ‹ã‚è¾¼ã¿ã‚’ã—ã¦ã¿ã‚‹

[æ˜¨æ—¥ã®è¨˜äº‹](https://zenn.dev/katzumi/articles/runn-tutorial-day15) ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJSONï¼‰åŒ–ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ 
ä»Šå›ã¯ã€1 ã¤ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã§æŸ”è»Ÿã«ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¢—ã‚„ã›ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

å‰å›ã®ã‚·ãƒŠãƒªã‚ªã®å†…å®¹ã¯å¤§ããæŒ™å‹•ã‚’å¤‰ãˆãšã« include ã‚’çµ„ã¿åˆã‚ã›ãŸã‚·ãƒŠãƒªã‚ªã«ã—ã¦ã„ã¾ã™ã€‚

* json-template.yml  
ãƒ¡ã‚¤ãƒ³ã‚·ãƒŠãƒªã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
* post-scrap.yml  
å‰å›ã®ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã‚’ç™»éŒ²ã™ã‚‹ã‚·ãƒŠãƒªã‚ªã‚’åˆ†å‰²ã—ã¦ã„ã¾ã™ã€‚
* scrap.json.template  
ä»Šå›ã®è‚ã¨ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

https://github.com/k2tzumi/runn-tutorial/blob/main/day16/json-template.yml

å¤‰æ›´ãŒã‚ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

https://github.com/k2tzumi/runn-tutorial/blob/main/day16/json-template.yml#L9-L15

ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã®ç™»éŒ²å‡¦ç†ãŒ include ã«æ›¸ãç›´ã•ã‚Œã¦ã„ã¾ã™ã€‚
å‰å›ã¯ vars ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸãŒã€include æ™‚ã® vars ã§ã‚‚ json å±•é–‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã¡ã‚‰ã®è¨˜è¿°æ–¹æ³•ã¯ ["includeã—ãŸã‚·ãƒŠãƒªã‚ªã®å¤‰æ•°ã‚’æ›¸ãæ›ãˆã‚ˆã†"](https://zenn.dev/katzumi/articles/runn-tutorial-day13) ã‚’å‚ç…§ãã ã•ã„ã€‚

ã‚ã¨æ–°ã—ã„è¦ç´ ã¨ã—ã¦çµ„ã¿è¾¼ã¿é–¢æ•° `faker.UUID()` ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚
ã“ã¡ã‚‰ã§ãƒ€ãƒŸãƒ¼ã® UUID ã‚’ç™ºè¡Œã§ãã¾ã™ã€‚
runn ã«ã¯ä»–ã«ã‚‚ä¾¿åˆ©ãªçµ„ã¿è¾¼ã¿é–¢æ•°ãŒå¹¾ã¤ã‹ã‚ã‚‹ã®ã§ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ`Additional built-in functions`ï¼‰ã‚’å‚ç…§ãã ã•ã„ã€‚

https://github.com/k1LoW/runn#additional-built-in-functions

æ¬¡ã® 2,3 ã‚¹ãƒ†ãƒƒãƒ—ç›®ã¯å‰å›ã¨ã»ã¼åŒã˜ãªã®ã§å‰²æ„›ã—ã¦ã€post-scrap.yml ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚


https://github.com/k2tzumi/runn-tutorial/blob/main/day16/post-scrap.yml

å˜ç´”ã«å‰å›ã® 1 ã‚¹ãƒ†ãƒƒãƒ—ç›®ã‚’ãã®ã¾ã¾åˆ‡ã‚Šå‡ºã—ãŸæ„Ÿã˜ã«ãªã‚ã‚Šã¾ã™ã€‚

æ¬¡ã«ãƒ¡ã‚¤ãƒ³ã® scrap.json.template ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

https://github.com/k2tzumi/runn-tutorial/blob/main/day16/scrap.json.template

ä¸­èº«ã¯ JSON ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åŸ‹ã‚è¾¼ã¿ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

`{{.vars.title_suffix }}`

ã“ã¡ã‚‰ã®è¨˜è¿°æ–¹æ³•ã¯ [Go Template](https://pkg.go.dev/text/template) ã«ãªã‚Šã¾ã™ã€‚
Go Template ã¨ã—ã¦èªè­˜ã•ã›ã‚‹ã«ã¯ã€€`.json.template` ã¨ã„ã†æ‹¡å¼µå­ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Template è‡ªä½“ã®è¨˜æ³•ã«ã¤ã„ã¦ã¯è©³ã—ãã¯èª¬æ˜ã—ã¾ã›ã‚“ãŒã€ã“ã¡ã‚‰ã®è¨˜è¿°ã§ `title_suffix` å¤‰æ•°ãŒå±•é–‹ã•ã‚Œã¾ã™ã€‚
include å…ƒã§ãƒ€ãƒŸãƒ¼ã® UUID ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã©ã†ã„ã†å€¤ãŒå±•é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ã¯ debug ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€‚

```console
% SESSION="miserarenaiyo" runn run day16/json-template.yml --verbose
=== JSONãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®æŸ”è»Ÿæ€§ã‚’é«˜ã‚ã¾ã—ã‚‡ã† (day16/json-template.yml) ... ok
    --- ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã‚’ç™»éŒ²ã—ã¾ã™ (postScrap) ... ok
        === JSONãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚·ãƒŠãƒªã‚ª (day16/post-scrap.yml) ... ok
            --- ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã‚’ç™»éŒ²ã—ã¾ã™ (postScrap) ... ok
    --- ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã™ (archiveScrap) ... ok
    --- ã‚¹ã‚¯ãƒ©ãƒƒãƒ—è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã™ (deleteScrap) ... ok


1 scenario, 0 skipped, 0 failures
```

SESSION ã«ä½•ã‚’æŒ‡å®šã•ã›ã‚‹ã‹ï¼Ÿã¯ ["ãƒªã‚¯ã‚¨ã‚¹ãƒˆJSONã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹ > å‰æº–å‚™"](https://zenn.dev/katzumi/articles/runn-tutorial-day15#å‰æº–å‚™) ã‚’å‚ç…§ãã ã•ã„ã€‚

Go Template ã‚’ä½¿ã†ã¨ã€ä¸€éƒ¨å€¤ãŒé•ã†ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã§å¤§å¤‰ä¾¿åˆ©ã§ã™ã€‚

æ˜æ—¥ã¯ã€Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ dump ã—ã¦å¤–éƒ¨ JSON åŒ–ã™ã‚‹ã€ã§ã™ã€‚

https://zenn.dev/katzumi/articles/runn-tutorial-day17